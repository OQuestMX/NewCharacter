<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>El Llamado de la Dama de Cristal</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
  :root { --fg:#fff; --bg:#000; --pane:#111; --glow:#fff; --accent:#4ddbff; --speed:22ms; }
  html,body{height:100%}
  body{
    font-family:'VT323',monospace; background:#000; color:#fff; margin:0; padding:20px;
    min-height:100vh; display:flex; align-items:center; justify-content:center; text-shadow:0 0 5px var(--fg);
    font-size: 1.5em; /* Letra más grande */
  }
  .container{
    padding:20px; background:#000;
    max-width:880px; width:100%; height: 90vh; display:flex; flex-direction:column; position:relative;
    overflow-y: auto; /* Habilita el scroll vertical */
    text-align: center; /* Texto centrado */
  }
  .dream-screen{ background:#000; border:none; }
  
  /* Estilo para los Íconos SVG */
  .scene-icon {
    width: 60%;
    max-width: 250px;
    margin: 20px auto;
    color: var(--fg);
  }
  .scene-icon svg {
    width: 100%;
    height: auto;
    filter: drop-shadow(0 0 6px var(--glow));
  }
  .c1 { color: #4ddbff; fill: #4ddbff; } /* Cyan/Accent */
  .c2 { color: #ffd700; fill: #ffd700; } /* Yellow/Gold */
  .c3 { color: #90ee90; fill: #90ee90; } /* Light Green */
  .c4 { color: #8b4513; fill: #8b4513; } /* Brown */
  .c5 { color: #ccc; }    /* Grey - sin fill */

  .shake{ animation:shake .18s linear 1; }
  @keyframes shake{ 0%{transform:translate(1px,0)} 25%{transform:translate(-2px,0)} 50%{transform:translate(2px,0)} 75%{transform:translate(-1px,0)} 100%{transform:none}}
  h1,h2{ margin:20px 0 8px; text-align:center; text-shadow:0 0 8px var(--fg); }
  .type { white-space:pre-wrap; }
  .typewriter{ position:relative }
  .cursor{ display:inline-block; width:.6ch; border-right:2px solid #fff; animation:blink .8s step-end infinite; }
  @keyframes blink{ 50%{ border-color:transparent } }
  .dialogue{
    color:var(--accent); text-shadow:0 0 10px var(--accent), 0 0 2px var(--accent);
    animation:glitch 2.4s infinite steps(2,end);
  }
  @keyframes glitch{
    0%,100%{ transform:none; filter:none }
    10%{ transform:translateX(.6px); text-shadow:-1px 0 var(--accent), 1px 0 #fff; }
    11%{ transform:none; text-shadow:0 0 10px var(--accent) }
    55%{ filter:contrast(115%) brightness(105%) }
  }

  .choice{ display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-top:20px; }
  .btn{
    padding:12px 18px; border:2px solid var(--fg); background:#000; color:#fff; text-decoration:none; cursor:pointer;
    transition:all .12s;
  }
  .btn:hover{ background:#fff; color:#000; }
  
  /* Estilos para creación de personaje */
  .creation-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    align-items: center;
    width: 80%;
    max-width: 400px;
    margin: 0 auto;
  }
  .form-group {
    display: flex;
    flex-direction: column;
    width: 100%;
    text-align: left;
  }
  .form-group label {
    margin-bottom: 5px;
    font-size: 0.9em;
  }
  .form-group input, .form-group select {
    background: #000;
    color: #fff;
    border: 2px solid var(--fg);
    padding: 10px;
    font-family: inherit;
    font-size: 1em;
    width: 100%;
    box-sizing: border-box;
  }
  .form-group select option {
    background: #000;
    color: #fff;
  }
  
  /* Estilo de Papiro para el Pacto */
  .pact-document{
    background: #f5deb3; /* Color papiro */
    color: #3a2d0d; /* Color tinta oscura */
    border: 2px solid #8b4513;
    padding:16px; margin-top:6px; text-align:center; 
    box-shadow: 0 0 10px #000;
    font-size: 0.9em;
    text-shadow: 0 0 1px #3a2d0d88;
  }
  .document-title{ 
    color: #3a2d0d;
    font-weight:bold; 
    text-shadow: none;
  }
  .pact-legend {
    font-size: 1.1em;
    font-style: italic;
    opacity: 1;
    margin-top: 1em;
    color: #b8860b; /* Dorado oscuro */
    text-shadow: 0 0 4px #ffd700;
    animation: glow-legend 3s infinite alternate;
  }
  @keyframes glow-legend {
    from { text-shadow: 0 0 3px #ffd700; }
    to { text-shadow: 0 0 8px #fff, 0 0 12px #ffd700; }
  }

</style>
</head>
<body>
  <div id="game" class="container"></div>

<script>
const game = document.getElementById('game');

let playerName = '';
let playerClass = '';
let playerLine = '';

// Beneficios por clase cuando NO reencarnan
const mortalBoons = {
  'Guerrero':'Bendición de Acero: +1 al daño cuerpo a cuerpo.',
  'Druida':'Pulso Druídico: una vez por día, curación menor como acción bonus.',
  'Brujo':'Eco del Pacto: 1 vez/encuentro repite una tirada de ataque de conjuro.',
  'Paladín':'Aura Prestada: 1 vez/encuentro concede +1 a CA a un aliado por 1 escena.',
  'Monje':'Paso de Cristal: ventaja en una prueba de Destreza por escena.',
  'Cazador de Sangre':'Tinte Etéreo: ignora resistencia no mágica 1 vez/encuentro.',
  'Bardo':'Verbo Lumínico: 1 vez/encuentro, inspiración adicional (+1).',
  'Pícaro':'Sombra de Cristal: ventaja en Sigilo.',
  'Clérigo':'Luz Prestada: sanar a un aliado 1 vez por aventura sin coste.'
};

//--- Iconos SVG para las escenas ---
const svgIcons = {
  voice: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g stroke="currentColor" stroke-width="2"><path d="M30 50 C 40 40, 60 40, 70 50"><animate attributeName="d" values="M30 50 C 40 40, 60 40, 70 50; M30 50 C 40 60, 60 60, 70 50; M30 50 C 40 40, 60 40, 70 50" dur="2s" repeatCount="indefinite"/></path><path d="M20 50 C 40 30, 60 30, 80 50" opacity="0.6"><animate attributeName="d" values="M20 50 C 40 30, 60 30, 80 50; M20 50 C 40 70, 60 70, 80 50; M20 50 C 40 30, 60 30, 80 50" dur="2s" begin="0.5s" repeatCount="indefinite"/></path><path d="M40 50 C 45 45, 55 45, 60 50" opacity="0.8"><animate attributeName="d" values="M40 50 C 45 45, 55 45, 60 50; M40 50 C 45 55, 55 55, 60 50; M40 50 C 45 45, 55 45, 60 50" dur="1.5s" repeatCount="indefinite"/></path></g></svg>`,
  identity: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g stroke="currentColor" stroke-width="1.5"><path d="M50 30 C 30 30, 20 50, 20 65 S 35 95, 50 95 S 80 80, 80 65 S 70 30, 50 30 Z"><animateTransform attributeName="transform" type="rotate" from="0 50 65" to="360 50 65" dur="15s" repeatCount="indefinite"/></path><path d="M50 55 C 40 55, 35 65, 35 75"><animate attributeName="d" values="M50 55 C 40 55, 35 65, 35 75; M50 55 C 45 58, 40 65, 40 75; M50 55 C 40 55, 35 65, 35 75" dur="4s" repeatCount="indefinite"/></path><path d="M50 55 C 60 55, 65 65, 65 75"><animate attributeName="d" values="M50 55 C 60 55, 65 65, 65 75; M50 55 C 55 58, 60 65, 60 75; M50 55 C 60 55, 65 65, 65 75" dur="4s" repeatCount="indefinite"/></path><circle cx="50" cy="50" r="20" stroke-dasharray="4 4"><animateTransform attributeName="transform" type="rotate" from="360 50 50" to="0 50 50" dur="10s" repeatCount="indefinite"/></circle></g></svg>`,
  sky1: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round"><g stroke="currentColor" stroke-width="1.5"><path d="M70 25 A 20 20 0 1 0 60 75 A 15 15 0 1 1 70 25 Z" stroke-dasharray="2 2"/><circle cx="72" cy="35" r="2" fill="currentColor"/><circle cx="60" cy="65" r="3" fill="currentColor"/></g><g stroke="currentColor" stroke-width="2"><circle cx="20" cy="65" r="1"/><circle cx="45" cy="85" r="1"/><circle cx="80" cy="80" r="1"/><path d="M5 5 L 95 95"><animate attributeName="d" from="M5 5 L 15 15" to="M85 85 L 95 95" dur="4s" repeatCount="indefinite"/></path></g></svg>`,
  sky2: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round"><g class="c2" stroke="currentColor"><circle cx="50" cy="50" r="15" fill="currentColor"/><g stroke-width="2"><path d="M50 30 V 10"/><path d="M25 50 H 5"/><path d="M75 50 H 95"/><path d="M32 32 L 18 18"/><path d="M68 32 L 82 18"/><path d="M32 68 L 18 82"/><path d="M68 68 L 82 82"/><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="20s" repeatCount="indefinite"/></g></g><g class="c5" fill="none"><path stroke="currentColor" stroke-width="2" d="M-10 80 C 20 70, 40 70, 50 75 S 80 80, 110 75 V 100 H -10 Z"><animate attributeName="d" from="M-10 80 C 20 70, 40 70, 50 75 S 80 80, 110 75 V 100 H -10 Z" to="M-10 75 C 20 85, 40 85, 50 80 S 80 75, 110 80 V 100 H -10 Z" dur="5s" repeatCount="indefinite"/></path></g></svg>`,
  ladyBench: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g class="c1" stroke="currentColor" stroke-width="2"><circle cx="50" cy="15" r="10"><animate attributeName="r" values="10;11;10" dur="3s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.8;1;0.8" dur="3s" repeatCount="indefinite"/></circle><path d="M50 25 V 70" /><path d="M50 35 C 20 25, 10 45, 10 65" /><path d="M50 35 C 80 25, 90 45, 90 65" /><path d="M50 45 C 25 45, 20 60, 20 80" /><path d="M50 45 C 75 45, 80 60, 80 80" /></g></svg>`,
  benchTree: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g class="c4" stroke="currentColor" stroke-width="3"><path d="M30 90 V 40 C 25 20 55 20 50 40 V 60"/><path d="M50 50 C 65 45 75 50 75 60"/><path d="M50 40 C 35 35 15 40 15 50"/></g><g class="c1"><circle cx="25" cy="40" r="3" fill="currentColor"><animate attributeName="r" values="2;4;2" dur="3s" repeatCount="indefinite"/></circle><circle cx="45" cy="35" r="2" fill="currentColor"><animate attributeName="r" values="3;1;3" dur="4s" repeatCount="indefinite" begin="1s"/></circle><circle cx="65" cy="55" r="2" fill="currentColor"><animate attributeName="r" values="1;3;1" dur="3s" repeatCount="indefinite" begin="2s"/></circle></g><g class="c5" stroke="currentColor" stroke-width="2" fill="none"><circle cx="82" cy="63" r="4"/><path d="M82 67 V 81"/><path d="M77 88 L 82 81 L 87 88"/></g><g class="c1" stroke="currentColor" stroke-width="1.5" transform="translate(58, 58) scale(0.35)"><circle cx="50" cy="15" r="10"/><path d="M50 25 V 70" /><path d="M50 35 C 20 25, 10 45, 10 65" /><path d="M50 35 C 80 25, 90 45, 90 65" /><path d="M50 45 C 25 45, 20 60, 20 80" /><path d="M50 45 C 75 45, 80 60, 80 80" /></g><path class="c1" stroke="currentColor" stroke-width="3" d="M60 90 H 90" fill="currentColor" opacity="0.3"/></svg>`,
  goblet: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round"><g class="c1"><path stroke="currentColor" stroke-width="3" d="M25 10 H 75 C 70 45, 50 55, 50 55 C 50 55, 30 45, 25 10 Z"/><path stroke="currentColor" stroke-width="2" d="M50 55 V 88"/><path stroke="currentColor" stroke-width="3" d="M35 88 H 65"/><path stroke="none" fill="currentColor" opacity="0.6" d="M30 20 C 40 30, 60 30, 70 20 V 10 H 30 Z"/><circle cx="40" cy="25" r="1.5" fill="#fff"><animateMotion dur="3s" repeatCount="indefinite" path="M0,0 C 10,-5 10,-15 20,-20" /></circle><circle cx="60" cy="30" r="1" fill="#fff"><animateMotion dur="4s" repeatCount="indefinite" path="M0,0 C -10,-5 -10,-15 -20,-25" /></circle></g></svg>`,
  surge: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round"><g class="c5" stroke="currentColor" stroke-width="3" fill="none"><circle cx="50" cy="50" r="8"/><path d="M50 58 V 80"/><path d="M40 90 L 50 80 L 60 90"/></g><g class="c1" stroke="currentColor" stroke-width="2"><circle cx="50" cy="50" r="10" stroke-width="1.5" fill="none"><animate attributeName="r" values="10;45" dur="1.5s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0" dur="1.5s" repeatCount="indefinite"/></circle><circle cx="50" cy="50" r="10" stroke-width="1.5" fill="none"><animate attributeName="r" values="10;45" dur="1.5s" begin="0.5s" repeatCount="indefinite"/><animate attributeName="opacity" values="1;0" dur="1.5s" begin="0.5s" repeatCount="indefinite"/></circle></g></svg>`,
  hand: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g class="c1" stroke="currentColor" stroke-width="2"><path d="M90 100 C 70 80, 60 60, 55 45"/><path d="M55 45 C 50 35, 40 30, 30 35 C 20 40, 25 55, 40 55 C 55 55, 57 48, 55 45 Z" fill="currentColor" opacity="0.1"/><path d="M30 35 Q 20 20, 25 10"/><path d="M35 32 Q 30 15, 38 8"/><path d="M42 33 Q 45 15, 50 10"/><path d="M48 38 Q 55 25, 60 20"/><path d="M40 55 Q 50 65, 60 60"/></g><g class="c1" fill="currentColor"><circle cx="50" cy="50" r="2"><animate attributeName="r" values="1;3;1" dur="2s" repeatCount="indefinite"/><animate attributeName="opacity" values="0.5;1;0.5" dur="2s" repeatCount="indefinite"/></circle><path d="M50 50 L 25 10" stroke="currentColor" stroke-width="0.5" stroke-dasharray="2 2"><animate attributeName="stroke-dashoffset" from="0" to="10" dur="1.5s" repeatCount="indefinite"/></path><path d="M50 50 L 60 20" stroke="currentColor" stroke-width="0.5" stroke-dasharray="2 2"><animate attributeName="stroke-dashoffset" from="10" to="0" dur="1.5s" repeatCount="indefinite"/></path></g></svg>`,
  visionCrown: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g class="c2" stroke="currentColor" stroke-width="2.5"><path d="M20 40 L 10 60 L 30 60 L 40 40 L 50 60 L 60 40 L 70 60 L 90 60 L 80 40 Z" fill="currentColor" opacity="0.8"/><circle cx="50" cy="35" r="10" fill="currentColor"/></g><g class="c4" stroke="currentColor" stroke-width="3"><path d="M5 80 L 25 70 L 45 80 L 65 70 L 85 80 L 95 70"><animate attributeName="d" values="M5 80 L 25 70 L 45 80 L 65 70 L 85 80 L 95 70; M5 82 L 25 72 L 45 82 L 65 72 L 85 82 L 95 72; M5 80 L 25 70 L 45 80 L 65 70 L 85 80 L 95 70" dur="1s" repeatCount="indefinite"/></path></g><g class="c1" stroke="currentColor" stroke-width="1.5"><path d="M10 90 Q 50 80 90 90"/><path d="M15 95 Q 50 85 85 95"/></g></svg>`,
  visionWarrior: `<svg viewBox="0 0 100 100" fill="none" stroke-linecap="round" stroke-linejoin="round"><g class="c2" stroke="currentColor" stroke-width="2"><circle cx="50" cy="30" r="8" fill="currentColor"/><path d="M50 38 V 65"/><path d="M35 80 L 50 65 L 65 80"/><path d="M50 45 L 20 35"/><path d="M50 45 L 80 35"/><path d="M40 60 L 25 75"/><path d="M60 60 L 75 75"/></g><g class="c2" stroke="currentColor" stroke-width="1.5" opacity="0.7"><path d="M30 85 L 20 90 L 40 90 L 50 85 L 60 90 L 80 90 L 70 85 Z" fill="currentColor"/></g><g class="c2" stroke="currentColor" stroke-width="1"><path d="M50 5 L 50 20"/><path d="M20 30 L 35 40"/><path d="M80 30 L 65 40"/><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="360 50 50" dur="8s" repeatCount="indefinite"/></g></svg>`
};

//— Escenas —
const scenes = {
  intro1: {
    dream: true,
    text: 'Cierras los ojos... y de pronto, te rodea un sentimiento profundo de angustía...',
    next: 'intro2',
    sting: true
  },
  intro2: {
    dream: true,
    svg: svgIcons.voice,
    dialogue: 'Se escucha una voz familiar, entrelazada de pasados y futuros inciertos... "¿Quién eres?"',
    next: 'selectCharacter',
    sting: true
  },
  selectCharacter: {
    title:'Identifica tu Personaje',
    svg: svgIcons.identity,
    render() {
      game.innerHTML = '';
      game.classList.remove('dream-screen');
      
      const iconContainer = div('scene-icon');
      iconContainer.innerHTML = this.svg;
      game.appendChild(iconContainer);

      const titleEl = document.createElement('h1');
      titleEl.textContent = this.title;
      game.appendChild(titleEl);
      
      const form = document.createElement('div');
      form.className = 'creation-form';
      
      // Input para el nombre
      const nameGroup = div('form-group');
      const nameLabel = document.createElement('label');
      nameLabel.setAttribute('for', 'nameInput');
      nameLabel.textContent = 'Tu Nombre:';
      const nameInput = document.createElement('input');
      nameInput.type = 'text';
      nameInput.id = 'nameInput';
      nameGroup.appendChild(nameLabel);
      nameGroup.appendChild(nameInput);
      form.appendChild(nameGroup);

      // Dropdown para la clase
      const classGroup = div('form-group');
      const classLabel = document.createElement('label');
      classLabel.setAttribute('for', 'classSelect');
      classLabel.textContent = 'Tu Clase:';
      const classSelect = document.createElement('select');
      classSelect.id = 'classSelect';
      Object.keys(mortalBoons).forEach(className => {
        const option = document.createElement('option');
        option.value = className;
        option.textContent = className;
        classSelect.appendChild(option);
      });
      classGroup.appendChild(classLabel);
      classGroup.appendChild(classSelect);
      form.appendChild(classGroup);

      game.appendChild(form);

      const choiceDiv = div('choice');
      const continueBtn = linkBtn('Continuar', () => {
        playerName = nameInput.value || 'Viajero';
        playerClass = classSelect.value;
        playerLine = `${playerClass}`;
        goto('dream1');
      });
      choiceDiv.appendChild(continueBtn);
      game.appendChild(choiceDiv);
    }
  },

  dream1: { dream:true, svg: svgIcons.sky1, text: 'Mientras duermes, se escucha el silbido del viento.', next:'dream2', sting:true },
  dream2: { dream:true, svg: svgIcons.sky2, text: 'Ves como de la negrura se expande un paisaje paradisíaco infinito.', next:'dream3' },
  dream3: { dream:true, svg: svgIcons.ladyBench, text: 'Frente a ti aparece la Dama de Cristal y te invita a sentarte.', next:'scene4' },

  scene4: {
    svg: svgIcons.benchTree,
    text: 'Te sientas junto a ella. Su voz es un susurro que retumba.',
    dialogue: '"No es suficiente... ese cuerpo... ese poder que tienes..."',
    choices:[{t:'Continuar', n:'scene5'}],
    sting:true
  },

  scene5: {
    svg: svgIcons.goblet,
    text: 'Una copa translúcida brilla con luz interior.',
    dialogue:'"Ten, bebe... te sentirás mejor."',
    choices:[{t:'Beber', n:'vision1'},{t:'Rechazar', n:'regret'}]
  },

  vision1: {
    dream: true,
    svg: svgIcons.visionCrown,
    text: 'Separten los cielos y ven como del fondo del mar se eleva una corona dorada gigante. La corona brilla y suena a trompetas destruyendo montañas y valles.',
    next: 'vision2',
    sting: true
  },
  vision2: {
    dream: true,
    svg: svgIcons.visionWarrior,
    text: 'De la corona emerge un guerrero bañado en luz dorada y la corona que antes era monstruosa se encoje al tamaño del guerrero.',
    next: 'scene6',
    sting: true
  },
  regret: {
    title: 'Una Oportunidad Perdida',
    svg: svgIcons.ladyBench,
    dialogue: '"Lástima... pudiste haber visto cómo el Emperador se levanta... en fin... continuemos"',
    next: 'start',
    sting: true
  },

  scene6: {
    svg: svgIcons.surge,
    text:'El líquido despierta un pulso antiguo en tu pecho.',
    dialogue:'"Zavros, nunca entendió para qué es el pacto... tu lo vivirás... Este mundo se deshilacha. Tu decisión anclará o cortará sus hebras."',
    choices:[{t:'Avanzar a la decisión', n:'start'}],
    sting:true
  },

  start: {
    svg: svgIcons.hand,
    text: () => `“${playerName}, ${playerLine}. El velo se desgarra. Puedes unirte a mi esencia para renacer como Avatar o conservar tu ser mortal y caminar como mi aliado.”`,
    choices:[ {t:'Aceptar la reencarnación', n:'aceptar'}, {t:'Mantener mi ser', n:'rechazar'} ],
    sting:true
  },

  aceptar: {
    text:'La luz te envuelve. No hay dolor, solo un ensamblaje de propósito.',
    document: () => ({
      title:`Pacto de Reencarnación de ${playerName}`,
      body:`Yo, <strong>${playerName}</strong>, renuncio a mi forma mortal para renacer como Avatar de la Dama de Cristal. Seré conducto y guardián de los planos.`,
      legend: `Podrás crear un nuevo personaje de tu mismo nivel para la siguiente sesión.`
    }),
    choices:[{t:'Comenzar de nuevo', n:'intro1'}]
  },

  rechazar: {
    title:'El Camino Propio',
    text:'La Dama asiente. Una astilla de luz se incrusta en tu pecho.',
    document: () => {
      const boon = mortalBoons[playerClass] || 'Marca del Plano: ventaja en una tirada clave por escena.';
      return {
        title:`Pacto de Alianza de ${playerName}, ${playerClass}`,
        body:`Elijo mantener mi forma mortal. Recibo la bendición: <em>${boon}</em>. Caminaré con voluntad propia y favor del Plano de Cristal.`
      };
    },
    choices:[{t:'Comenzar de nuevo', n:'intro1'}]
  }
};

//— Render core —
function goto(id){
  const s = scenes[id];

  if (s.render) {
    s.render();
    return;
  }

  game.classList.toggle('dream-screen', !!s.dream);
  game.innerHTML = '';
  game.style.opacity = 0;
  requestAnimationFrame(()=>{ game.style.transition='opacity .18s'; game.style.opacity=1; });

  if (s.svg) {
    const iconContainer = div('scene-icon');
    if(s.colorClass) iconContainer.classList.add(s.colorClass);
    iconContainer.innerHTML = s.svg;
    game.appendChild(iconContainer);
  }
  
  if (s.title) header(s.title);

  const p = document.createElement('p'); 
  p.className='type typewriter';
  const text = typeof s.text === 'function' ? s.text() : (s.text||'');
  game.appendChild(p);
  typeIn(p, text, 22);

  if (s.dialogue){
    const d = document.createElement('p'); 
    d.className='dialogue typewriter';
    game.appendChild(d);
    typeIn(d, s.dialogue, 18, ()=>pulse());
  }

  if (s.document){
    const data = typeof s.document === 'function' ? s.document() : s.document;
    const doc = div(data.legend ? 'pact-document' : 'celestial-document');
    doc.innerHTML = `<h3 class="document-title">${data.title}</h3><p>${data.body}</p>`;
    // Añadir la leyenda si existe
    if (data.legend) {
        const legendEl = document.createElement('p');
        legendEl.className = 'pact-legend';
        legendEl.textContent = data.legend;
        doc.appendChild(legendEl);
    }
    game.appendChild(doc);
  }

  if (s.choices){
    const ch = div('choice');
    s.choices.forEach(c=>{
      const b = linkBtn(c.t, ()=>goto(c.n));
      ch.appendChild(b);
    });
    game.appendChild(ch);
  } else if (s.next){
    const ch = div('choice'); 
    ch.appendChild(linkBtn('Continuar', ()=>goto(s.next))); 
    game.appendChild(ch);
  }
  
  if (s.sting) pulse();
}

function typeIn(el, str, speed=24, done){
  el.textContent = '';
  const cursor = document.createElement('span'); cursor.className='cursor'; el.appendChild(cursor);
  let i=0;
  const tick = () => {
    if (i<str.length){
      cursor.insertAdjacentText('beforebegin', str[i++]);
      setTimeout(tick, speed);
    } else {
      cursor.remove();
      if (done) done();
    }
  };
  tick();
}

function pulse(){ 
  game.classList.remove('shake'); void game.offsetWidth; game.classList.add('shake');
}

function header(t, parent = game){ const h=document.createElement('h1'); h.textContent=t; parent.appendChild(h); }
function div(c){ const e=document.createElement('div'); if(c) e.className=c; return e; }
function linkBtn(txt,fn){ const a=document.createElement('a'); a.href='#'; a.className='btn'; a.textContent=txt; a.onclick=(e)=>{e.preventDefault(); fn();}; return a; }

// Inicio
goto('intro1');
</script>
</body>
</html>
